var PAGE_MY_RELAY=function(){function e(){RELAY_USER.hasAccount()?(o(),t()):($(".relayUserName").html("MANGLER KONTO"),$("#pageMyRelay").find("div:first").nextAll().remove())}function t(){$.when(RELAY_USER.contentXHR(),RELAY_USER.diskusageXHR()).done(function(e,t){RELAY_USER.hasContent()&&(u=JSON.parse(JSON.stringify(e)),c=t,$.when(RELAY_USER.getPresentationsDeleteListXHR()).done(function(e){p=[];var t=[];$.each(u,function(n,a){$.each(e,function(e,o){if(a.path==o.path)return p[n]=a,p[n].in_deletelist=1,p[n].is_deleted=parseInt(o.deleted),p[n].is_moved=parseInt(o.moved),p[n].is_undelete=parseInt(o.undelete),p[n].timestamp=o.timestamp,t.push(n),!1})}),p=p.filter(function(){return!0}),t.reverse(),$.each(t,function(e,t){u.splice(t,1)}),i(u,c),l&&l.destroy(),r&&r.destroy(),s(u),d(p.filter(function(){return!0}))}))})}function n(){}function a(){}function o(){$.when(RELAY_USER.accountXHR()).done(function(e){$(".relayUserName").html(e.username),$(".relayUserEmail").html(e.email)})}function i(e,t){var n=0,a=$(p).size(),o=0;$.each(e,function(e,t){n+=t.hits,o+=t.duration_s}),$(".myRelayPresentationCount").html(e.length),$(".myRelayPresentationDeletedCount").html(a>0?a+" av disse slettet":"Ingen slettet"),$(".myRelayDurationTotal").html(UTILS.secToTimeAndDays(o)),$(".myRelayDiskUsage").html(UTILS.mib2gb(t[t.length-1].size_mib).toFixed(2)+"GB"),$(".myRelayHitCount").html(n)}function s(e){$("#myRelayContent").find(".ajax").show(),l=$("#myRelayContentTable").DataTable({bAutoWidth:!1,language:CONFIG.DATATABLES_LANGUAGE(),data:e,order:[[3,"desc"]],columns:[{data:"created_date",render:function(e,t,n,a){var o=new Date(1e3*e.sec);return o.getUTCFullYear()+"-"+UTILS.two(o.getUTCMonth()+1)+"-"+UTILS.two(o.getUTCDate())},bVisible:!1},{data:"title",render:function(e,t,n,a){return'<span class="text-blue" style="cursor: context-menu;" data-toggle="modal" data-arr-id="'+a.row+'" data-target="#myRelayPresentationModal">'+e+"</span>"}},{data:"description",render:function(e,t,n,a){return"<em>"+e+"</em>"}},{data:"created_date",render:function(e,t,n,a){var o=new Date(1e3*e.sec);return UTILS.two(o.getUTCDate())+". "+UTILS.months_short(o.getUTCMonth())+" "+o.getUTCFullYear()},iDataSort:0},{data:"duration_s",render:function(e,t,n,a){return UTILS.secToTime(e)}}]}),$("#myRelayContent").find(".ajax").hide()}function d(e){$("#myRelayDeletedContent").find(".ajax").show(),r=$("#myRelayDeletedContentTable").DataTable({bAutoWidth:!1,language:CONFIG.DATATABLES_LANGUAGE(),data:e,order:[[2,"desc"]],columns:[{data:"created_date",render:function(e,t,n,a){var o=new Date(1e3*e.sec);return o.getUTCFullYear()+"-"+UTILS.two(o.getUTCMonth()+1)+"-"+UTILS.two(o.getUTCDate())},bVisible:!1},{data:"title",render:function(e,t,n,a){return'<span data-arr-id="'+a.row+'">'+e+"</span>"}},{data:"created_date",render:function(e,t,n,a){var o=new Date(1e3*e.sec),i=UTILS.two(o.getUTCDate())+". "+UTILS.months_short(o.getUTCMonth())+" "+o.getUTCFullYear();return i},iDataSort:0},{data:"duration_s",render:function(e,t,n,a){return UTILS.secToTime(e)}},{data:"is_deleted",render:function(e,t,n,a){if(n.in_deletelist){if(n.is_deleted)return'<p><span class="label label-default">Utilgjengelig</span> - slettet permanent</p>';if(n.is_undelete)return'<p><span class="label label-success">Gjenopprettes</span> - blir snart tilgjengelig igjen</p>';if(n.is_moved){var o=new Date(n.timestamp).getTime(),i=Date.now(),s=Math.floor((i-o)/864e5);return'<p><span class="label label-danger">Slettes</span> - slettes permanent om <strong>'+(m-s)+"</strong> dager</p>"}return'<p><span class="label label-warning">Flyttes</span> - vil bli utilgjengelig kl. 03:00</span></p>'}return'<p><span class="label label-success">Tilgjengelig</span></p>'}},{data:"is_deleted",render:function(e,t,n,a){return n.in_deletelist?n.is_deleted?'<p class="text-center text-muted small">Slettet</p>':n.is_undelete?'<p class="text-center text-muted small" data-obj="'+e+'">Gjenopprettes</p>':n.is_moved?'<p class="text-center"><button data-trigger="undelete" type="button" data-type="moved" data-undelete-path="'+n.path+'" class="btn btn-primary btn-xs"> <i class="ion ion-ios-undo"></i> Angre</button></p>':'<p class="text-center"><button data-trigger="undelete" type="button" data-type="unmoved" data-restore-path="'+n.path+'"class="btn btn-primary btn-xs"> <i class="ion ion-ios-undo"></i> Angre</button></p>':'<p class="text-center">Tilgjengelig</p>'}}],rowCallback:function(e,t,n){t.is_deleted&&($(e).addClass("text-gray"),$(e).addClass("disabled"),$(e).css("text-decoration","line-through"))}}),$("#myRelayDeletedContent").find(".ajax").hide()}var l,r,u=[],c=[],p=[],m=14;return $("#myRelayPresentationModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget),n=u[t.data("arr-id")],a=$(this),o=a.find("#presentation_preview"),i=new Date(1e3*n.created_date.sec),s=UTILS.two(i.getUTCDate())+". "+UTILS.months_short(i.getUTCMonth())+" "+i.getUTCFullYear();a.find("#presentation_title").text(n.title),a.find("#presentation_description").text(n.description),a.find("#presentation_author").html("- "+n.recorded_by+"<br/>"+s),a.find("#presentation_hits").text(n.hits),a.find("#presentation_duration").html('<i class="ion ion-ios-clock"></i> '+UTILS.secToTime(n.duration_s)),o.html('<source src="'+CONFIG.SCREENCAST_BASE_URL()+n.files[1].path+'" type="video/mp4">'),o.load(),a.find("#presentation-files-table tbody").empty(),$.each(n.files,function(e,t){a.find("#presentation-files-table tbody").append("<tr><td>"+t.encoding+'</td><td><a class="text-light-blue" target="_blank" href="'+CONFIG.SCREENCAST_BASE_URL()+t.path+'">H&oslash;yreklikk...</a></td><td><a class="text-light-blue" data-dismiss="modal" data-toggle="modal" data-url="'+CONFIG.SCREENCAST_BASE_URL()+t.path+'" data-target="#myRelayEmbedModal" style="cursor: context-menu;"><i class="ion ion-android-share-alt"></i></a></td><td><span class="badge bg-black-gradient">'+t.hits+"</span></td></tr>")}),a.find("#presentation_delete").data("path",n.path)}),$("#myRelayPresentationModal").on("hide.bs.modal",function(e){document.getElementById("presentation_preview").pause()}),$("#pageMyRelay").find("#btnUpdateTables").on("click",function(e){var n=$(this);$("#myRelayContent").find(".ajax").show(),$("#myRelayDeletedContent").find(".ajax").show(),n.button("loading"),t(),n.button("reset")}),$("#pageMyRelay").on("click",'button[data-trigger="undelete"]',function(e){var n=$(this);switch(n.button("loading"),$("#myRelayContent").find(".ajax").show(),$("#myRelayDeletedContent").find(".ajax").show(),n.data("type")){case"moved":$.when(RELAY_USER.undeletePresentationXHR(n.data("undeletePath"))).done(function(e){n.button("reset"),t()});break;case"unmoved":$.when(RELAY_USER.removePresentationXHR(n.data("restorePath"))).done(function(e){n.button("reset"),t()})}}),$("#myRelayPresentationModal").find("#presentation_delete").on("click",function(e){if(confirm("Vil du slette denne presentasjonen?")){var n=$(this),a=n.data("path");n.button("loading"),$.when(RELAY_USER.deletePresentationXHR(a)).done(function(e){console.log(e),n.button("reset"),$("#myRelayPresentationModal").modal("hide"),t()})}}),$("#myRelayEmbedModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget),n=t.attr("data-url"),a=$("#myRelayEmbedModal").find("#embedcode");a.val('<video width="100%" height="auto" controls><source src="'+n+'" type="video/mp4">Your browser does not support the video tag.</video>'),a.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}),{init:function(){e()},hide:function(){n()},show:function(){a()},dimensionsChanged:function(e,t){dimensionsChanged(e,t)}}}();