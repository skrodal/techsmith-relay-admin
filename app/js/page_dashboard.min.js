var PAGE_DASHBOARD=function(){function e(){r(),t()}function t(){$("#pageDashboard").find("[id^=relayQueueMonitor]").find(".ajax").show(),$(".queueTotal").html('<i class="fa fa-spinner fa-pulse"></i>'),$.when(RELAY.serviceQueueXHR()).done(function(e){var t=e.length;$("#pageDashboard").find("[id^=relayQueueMonitor]").find(".ajax").hide(),$(".queueTotal").html(t),u=e,n()})}function n(){var e=$("#queueTableBody");if(e.html(""),0==u.length)return void e.html('<tr><td colspan="2"><strong>Det er ingen jobber i kø akkurat nå</strong></td></tr>');var t,n=!1,r=0,a=!1;$.each(u,function(o,i){t=i.jobPresentation_PresId,n||(n=t),r>0&&t!=n&&(e.append("<tr><td>#"+a.jobPresentation_PresId+"</td><td>"+a.jobQueuedDate+", kl. "+a.jobQueuedTime+"</td><td>"+r+"</td><td>"+UTILS.secToTime(a.presDuration/1e3)+"</td><td>"+a.presPresenterName.substring(0,a.presPresenterName.indexOf(" "))+"</td></tr>"),r=0,n=i.jobPresentation_PresId),r++,a=i}),e.append("<tr><td>#"+a.jobPresentation_PresId+"</td><td>"+a.jobQueuedDate+", kl. "+a.jobQueuedTime+"</td><td>"+r+"</td><td>"+UTILS.secToTime(a.presDuration/1e3)+"</td><td>"+a.presPresenterName.substring(0,a.presPresenterName.indexOf(" "))+"</td></tr>")}function r(){$("#subscriber_table_body").empty();var e,t="---",n="red";$.each(KIND.subscribers(),function(r,a){e="",t=KIND.subscriptionCodesToNames()[a.subscription_code],n=KIND.subscriptionCodesToColors()[a.subscription_code],a.org_id==DATAPORTEN.user().org.id&&(e="active"),$("#subscriber_table_body").append("<tr class='"+e+"'><td>"+a.org_id+"</td><td style='text-align: center;'><span class='label bg-"+n+"'>"+t+"</span></td></tr>")}),$("#pageDashboard").find("#subscribersTable").find(".ajax").hide()}function a(e){s();var t=[];$.each(e,function(e,n){t.push({value:n.users,color:"#"+(Math.random().toString(16)+"0000000").slice(2,8),highlight:"#"+(Math.random().toString(16)+"0000000").slice(2,8),label:""})});var n=document.getElementById("chartOrgsUserCountDashboard").getContext("2d");return new Chart(n).Pie(t,{})}function o(){$.when(RELAY.ready()).done(function(){d=a(RELAY.subscribersInfo()),$("#pageDashboard").find("#usersPie").find(".ajax").hide()}),RELAY_USER.hasAccount()||$("#relayAccountInfo").html("<p>"+DATAPORTEN.user().name.first+', du har ingen konto i tjenesten!</p><p><a href="'+CONFIG.RELAY_REGISTER_URL()+'" target="_blank" class="btn btn-info">Opprett konto</a></p>')}function i(){s()}function s(){d!==!1&&(d.destroy(),d=!1,$("#pageDashboard").find("#usersPie").find(".ajax").show())}var d=!1,u=[];return $(".updateQueue").on("click",function(){t()}),{init:function(){return e()},hide:function(){i()},show:function(){o()},refreshQueue:function(){t()}}}();