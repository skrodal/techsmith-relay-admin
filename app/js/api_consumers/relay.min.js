var RELAY=function(){function e(){d=c(),g=n(),y=t(),P=o(),v=u(),U=l(),A=i(),H=a(),$.when(d).done(function(e){T=e;var n=$.notify({icon:DATAPORTEN.user().photo,title:"Hey "+DATAPORTEN.user().name.first+", du er admin!",message:"Henter ekstra innhold for deg :-)"},{type:"minimalist",delay:1e5,icon_type:"image",template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert"><img data-notify="icon" class="img-circle pull-left"><span data-notify="title">{1}</span><span data-notify="message">{2}</span></div>'});j.resolve(),n.update({message:"Ferdig! Menyen er oppdatert."}),setTimeout(function(){n.close()},1e3)})}function n(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/version/",dataType:"json"}).pipe(function(e){return e.data.versValue}).fail(function(e,n,t){UTILS.alertError("Relay API (version):","Henting av data feilet.")})}function t(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/workers/",dataType:"json"}).pipe(function(e){return e.data.length}).fail(function(e,n,t){UTILS.alertError("Relay API (workerCount):","Henting av data feilet.")})}function r(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/queue/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (queue):","Henting av køstatus feilet. Prøv på nytt.")})}function a(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/queue/failed/",dataType:"json"}).pipe(function(e){return console.log(e),e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (queue):","Henting av køstatus feilet. Prøv på nytt.")})}function i(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/diskusage/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (queue):","Henting av lagring. Prøv på nytt.")})}function o(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/users/edupersonaffiliation/count/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (active user count):","Henting av data feilet.")})}function u(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/users/edupersonaffiliation/active/count/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (user count):","Henting av data feilet.")})}function s(e){if(DATAPORTEN.isSuperAdmin())return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"org/"+e+"/presentations/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(n,t,r){UTILS.alertError("Relay API (presentations):","Finner ingen presentasjoner for org  <code>"+e+"</code>")})}function f(e){if(DATAPORTEN.isSuperAdmin())return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"org/"+e+"/users/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(n,t,r){UTILS.alertError("Relay API (users):","Finner ingen brukere for org <code>"+e+"</code>")})}function c(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"admin/orgs/info/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (orgsStorage):","Henting av data feilet.")})}function l(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/presentations/count/",dataType:"json"}).pipe(function(e){return e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (presentationCount):","Henting av data feilet.")})}function p(e){return e="undefined"!=typeof e?e:30,DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/presentations/hits/daily/days/"+e+"/",dataType:"json"}).pipe(function(e){return!!e.status&&e.data}).fail(function(e,n,t){UTILS.alertError("Relay API (hitsByDay):","Henting av data feilet.")})}var d,T,g,y,A,H,P,v,U,_=12e3,j=$.Deferred();return{ready:function(){return j},init:function(){e()},subscribersInfoXHR:function(){return d},subscribersInfo:function(){return T},serviceVersionXHR:function(){return g},serviceWorkersXHR:function(){return y},serviceQueueXHR:function(){return r()},serviceQueueFailedJobsXHR:function(){return H()},serviceStorageXHR:function(){return A},usersTotalXHR:function(){return P},usersTotalActiveXHR:function(){return v},presentationsTotalXHR:function(){return U},hitsByDaysXHR:function(e){return p(e)},orgPresentationCount:function(e){return T[e]?T[e].presentations:0},orgPresentationListXHR:function(e){return s(e)},orgStorageTotalMiB:function(e){return T[e]?T[e].total_mib:0},orgStorageArr:function(e){return T[e]?T[e].storage:[]},orgUserCount:function(e){return T[e]?T[e].users:0},orgUserListXHR:function(e){return f(e)},storageCostTB:function(){return _},setStorageCost:function(e){return e=Number(e),isNaN(e)?(UTILS.alertError("Ugyldig verdi","Kostnaden du forsøker å legge inn er ikke et tall."),!1):(_=e,!0)}}}();