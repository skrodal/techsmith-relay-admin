var RELAY=function(){function n(){l=f(),d=e(),g=r(),y=i(),A=o(),H=c(),T=a(),$.when(l).done(function(n){p=n;var e=$.notify({icon:DATAPORTEN.user().photo,title:"Hey "+DATAPORTEN.user().name.first+", du er admin!",message:"Henter ekstra innhold for deg :-)"},{type:"minimalist",delay:1e5,icon_type:"image",template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert"><img data-notify="icon" class="img-circle pull-left"><span data-notify="title">{1}</span><span data-notify="message">{2}</span></div>'});U.resolve(),e.update({message:"Ferdig! Menyen er oppdatert."}),setTimeout(function(){e.close()},1e3)})}function e(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/version/",dataType:"json"}).pipe(function(n){return n.data.versValue}).fail(function(n,e,r){UTILS.alertError("Relay API (version):","Henting av data feilet.")})}function r(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/workers/",dataType:"json"}).pipe(function(n){return n.data.length}).fail(function(n,e,r){UTILS.alertError("Relay API (workerCount):","Henting av data feilet.")})}function t(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/queue/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,r){UTILS.alertError("Relay API (queue):","Henting av k&oslash;status feilet. Pr&oslash;v p&aring; nytt.")})}function a(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/diskusage/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,r){UTILS.alertError("Relay API (queue):","Henting av lagring. Pr&oslash;v p&aring; nytt.")})}function i(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/users/edupersonaffiliation/count/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,r){UTILS.alertError("Relay API (active user count):","Henting av data feilet.")})}function o(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/users/edupersonaffiliation/active/count/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,r){UTILS.alertError("Relay API (user count):","Henting av data feilet.")})}function u(n){if(DATAPORTEN.isSuperAdmin())return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"org/"+n+"/presentations/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(e,r,t){UTILS.alertError("Relay API (presentations):","Finner ingen presentasjoner for org  <code>"+n+"</code>")})}function s(n){if(DATAPORTEN.isSuperAdmin())return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"org/"+n+"/users/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(e,r,t){UTILS.alertError("Relay API (users):","Finner ingen brukere for org <code>"+n+"</code>")})}function f(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"admin/orgs/info/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,r){UTILS.alertError("Relay API (orgsStorage):","Henting av data feilet.")})}function c(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/presentations/count/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,r){UTILS.alertError("Relay API (presentationCount):","Henting av data feilet.")})}var l,p,d,g,T,y,A,H,P,v=12e3,U=$.Deferred();return{ready:function(){return U},init:function(){n()},subscribersInfoXHR:function(){return l},subscribersInfo:function(){return p},serviceVersionXHR:function(){return d},serviceWorkersXHR:function(){return g},serviceQueueXHR:function(){return t()},serviceStorageXHR:function(){return T},usersTotalXHR:function(){return y},usersTotalActiveXHR:function(){return A},presentationsTotalXHR:function(){return H},hitsLastWeekXHR:function(){return P},orgPresentationCount:function(n){return p[n]?p[n].presentations:0},orgPresentationListXHR:function(n){return u(n)},orgStorageTotalMiB:function(n){return p[n]?p[n].total_mib:0},orgStorageArr:function(n){return p[n]?p[n].storage:[]},orgUserCount:function(n){return p[n]?p[n].users:0},orgUserListXHR:function(n){return s(n)},storageCostTB:function(){return v},setStorageCost:function(n){return n=Number(n),isNaN(n)?(UTILS.alertError("Ugyldig verdi","Kostnaden du fors&oslash;ker &aring; legge inn er ikke et tall."),!1):(v=n,!0)}}}();