var RELAY=function(){function n(){T=c(),y=e(),A=t(),U=o(),v=u(),_=l(),H=i(),P=a(),$.when(T).done(function(n){g=n;var e=$.notify({icon:DATAPORTEN.user().photo,title:"Hey "+DATAPORTEN.user().name.first+", du er admin!",message:"Henter ekstra innhold for deg :-)"},{type:"minimalist",delay:1e5,icon_type:"image",template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert"><img data-notify="icon" class="img-circle pull-left"><span data-notify="title">{1}</span><span data-notify="message">{2}</span></div>'});D.resolve(),e.update({message:"Ferdig! Menyen er oppdatert."}),setTimeout(function(){e.close()},1e3)})}function e(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/version/",dataType:"json"}).pipe(function(n){return n.data.versValue}).fail(function(n,e,t){UTILS.alertError("Relay API (version):","Henting av data feilet.")})}function t(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/workers/",dataType:"json"}).pipe(function(n){return n.data.length}).fail(function(n,e,t){UTILS.alertError("Relay API (workerCount):","Henting av data feilet.")})}function r(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/queue/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (queue):","Henting av køstatus feilet. Prøv på nytt.")})}function a(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/queue/failed/",dataType:"json"}).pipe(function(n){return console.log(n),n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (queue):","Henting av køstatus feilet. Prøv på nytt.")})}function i(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/diskusage/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (queue):","Henting av lagring. Prøv på nytt.")})}function o(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/users/edupersonaffiliation/count/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (active user count):","Henting av data feilet.")})}function u(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/users/edupersonaffiliation/active/count/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (user count):","Henting av data feilet.")})}function s(n){if(DATAPORTEN.isSuperAdmin())return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"org/"+n+"/presentations/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(e,t,r){UTILS.alertError("Relay API (presentations):","Finner ingen presentasjoner for org  <code>"+n+"</code>")})}function f(n){if(DATAPORTEN.isSuperAdmin())return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"org/"+n+"/users/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(e,t,r){UTILS.alertError("Relay API (users):","Finner ingen brukere for org <code>"+n+"</code>")})}function c(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"admin/orgs/info/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (orgsStorage):","Henting av data feilet.")})}function l(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/presentations/count/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (presentationCount):","Henting av data feilet.")})}function p(n){return n="undefined"!=typeof n?n:30,DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/presentations/hits/daily/days/"+n+"/",dataType:"json"}).pipe(function(n){return!!n.status&&n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (hitsByDay):","Henting av data feilet.")})}function d(){return DP_AUTH.jso().ajax({url:DP_AUTH.config().api_endpoints.relay+"service/presentations/hits/total/",dataType:"json"}).pipe(function(n){return n.data}).fail(function(n,e,t){UTILS.alertError("Relay API (hitsTotal):","Henting av data feilet.")})}var T,g,y,A,H,P,U,v,_,j=12e3,D=$.Deferred();return{ready:function(){return D},init:function(){n()},subscribersInfoXHR:function(){return T},subscribersInfo:function(){return g},serviceVersionXHR:function(){return y},serviceWorkersXHR:function(){return A},serviceQueueXHR:function(){return r()},serviceQueueFailedJobsXHR:function(){return P()},serviceStorageXHR:function(){return H},usersTotalXHR:function(){return U},usersTotalActiveXHR:function(){return v},presentationsTotalXHR:function(){return _},hitsByDaysXHR:function(n){return p(n)},hitsTotalXHR:function(){return d()},orgPresentationCount:function(n){return g[n]?g[n].presentations:0},orgPresentationListXHR:function(n){return s(n)},orgStorageTotalMiB:function(n){return g[n]?g[n].total_mib:0},orgStorageArr:function(n){return g[n]?g[n].storage:[]},orgUserCount:function(n){return g[n]?g[n].users:0},orgUserListXHR:function(n){return f(n)},storageCostTB:function(){return j},setStorageCost:function(n){return n=Number(n),isNaN(n)?(UTILS.alertError("Ugyldig verdi","Kostnaden du forsøker å legge inn er ikke et tall."),!1):(j=n,!0)}}}();